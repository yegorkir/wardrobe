# Task Analysis Log

Этот файл используется для фиксации результатов этапов из `AGENTS.md`.

## TASK ANALYSIS
_(заполняется перед началом реализации; фиксируем, что именно нужно сделать)_

### 2023-12-16 — Адаптация AGENTS.md под GDScript
- Пользователь поделился примером `AGENTS.md` из Rust-проекта и попросил проанализировать его.
- Цель: перенести релевантные правила в собственный `AGENTS.md`, прежде чем вносить правки.

### 2023-12-16 — Уточнения от пользователя
- Все рабочие заметки/этапы логируем в `docs/notes`.
- Единственный язык задач — GDScript.
- MCP/документация: использовать https://context7.com/godotengine/godot.
- Документацию обязательно обновлять, следовать стилю из context7, использовать табы вместо пробелов.

### 2023-12-16 — Конспект `gdscript_guidelines.md`
- После добавления секции `# GDScript guidelines` в `AGENTS.md` нужно кратко изложить правила из `docs/gdscript_guidelines.md` (на английском) и вставить их в соответствующий блок.

### 2023-12-16 — Фиксация версии Godot
- Пользователь хочет описать в `AGENTS.md`, какую версию Godot Engine необходимо использовать (сейчас 4.5), и понять, где это видно в проекте.

## PLANNING: CODING
_(пошаговый план действий, который делаем после анализа)_

### 2023-12-16 — План по запросу
1. Обновить `AGENTS.md`, добавив полученные требования (docs/notes как рабочий путь, язык GDScript, ссылка на context7, обязательность обновлений документации, стиль/tab-инденты).
2. Зафиксировать изменения в этом файле (текущая заметка) и при необходимости скорректировать другие документы.

### 2023-12-16 — План по переводу AGENTS.md
1. Перевести все русскоязычные формулировки в `AGENTS.md` на английский, сохранив структуру и смысл.
2. Проверить, что текст остаётся последовательным и соответствует требованиям.

### 2023-12-16 — План по конспекту GDScript правил
1. Прочитать `docs/gdscript_guidelines.md` и выделить основные пункты.
2. Сформулировать лаконичный список правил на английском и добавить его в секцию `# GDScript guidelines` файла `AGENTS.md`.
3. После внесения изменений обновить этот журнал и убедиться, что документация актуальна.

### 2023-12-16 — План по коммитам
1. Проверить `git status` и убедиться, что в рабочем дереве нет чужих файлов в stage.
2. Проиндексировать файлы, относящиеся к настройкам `AGENTS.md` (сам файл, `docs/gdscript_guidelines.md`, записи в `docs/notes/...`).
3. Создать коммит с описанием изменений.
4. Снять индексацию (если нужно) и затем отдельно проиндексировать изменения в `export_presets.cfg`, создать второй коммит.

### 2023-12-16 — План по фиксации версии Godot
1. Найти, где в проекте фигурирует версия 4.5 (например, строка `config/features` в `project.godot`).
2. Заполнить секцию `## Godot Enguine Version` в `AGENTS.md`, указав требуемую версию и инструкцию по обновлению.
3. Сделать запись об изменении здесь и объяснить пользователю, где смотреть версию.

### 2023-12-16 — План по сквошу
1. Выполнить `git reset --soft HEAD~2`, чтобы вернуть изменения двух последних коммитов в индекс/рабочее дерево.
2. Создать новый коммит с объединённым описанием (охватывает AGENTS и export presets).
3. Проверить `git status`, убедиться, что лишние файлы не попали, и записать результат в журнал.

### 2023-12-16 — План: ответ по headless-билдам
1. Сформулировать краткое описание CLI-процесса сборки Godot (использование `godot`/`godot4` с `--headless` и `--export[-release]`).
2. Указать, что такие команды требуют настроенных export presets и приложить пример для трёх конфигураций.

### 2023-12-16 — План: команды для конкретных пресетов
1. Проверить названия пресетов в `export_presets.cfg` (`Web (itch.io)`, `Web (local)`, `macOS`).
2. Сформировать команды вида `godot4 --headless --export[-release/-debug] "<preset>" <output_path>` (release для itch.io, debug для остальных).
3. Добавить краткое пояснение (куда кладём результат, какие шаблоны нужны).

### 2023-12-16 — План: создать конфигурацию `just`
1. Создать `justfile` в корне проекта.
2. Добавить задачи `web-itch`, `web-local`, `mac-debug` с соответствующими командами `godot4 --headless --export-*`.
3. Добавить задачу `build-all`, зависящую от трёх предыдущих.

## PLANNING: AESTHETICS AND DESIGN
_(опционально, если нужны визуальные/стилистические заметки)_

## CODING / VERIFICATION NOTES
_(ключевые шаги и проверки после реализации)_

### 2023-12-16 — Обновлён AGENTS.md
- Добавлены требования: хранить заметки в `docs/notes`, язык задач — GDScript, стиль/инденты из context7, обязательные обновления документации, ссылка на context7 как основной источник.
- Проверено, что новые секции и буллеты присутствуют в `AGENTS.md`; дополнительных файлов менять не понадобилось.
- Обновлены правила использования context7 (всегда при генерации контента, исправлении ошибок и пользовательских запросах, связанных с работой программы; в остальных случаях — по усмотрению).
- Добавлено уточнение: контекст https://context7.com/godotengine/godot используем только в задачах, связанных с GDScript; для других языков — их собственные разделы context7.

### 2023-12-16 — Перевод AGENTS.md
- Все русскоязычные фрагменты (включая секцию про context7) переведены на английский.
- Проверено, что структура и требования документа не изменились.
### 2023-12-16 — Перевод AGENTS.md на английский
- Пользователь попросил переписать текущие инструкции `AGENTS.md` на английском языке.
- Нужно сохранить все правила/структуру, но перевести формулировки.

### 2023-12-16 — Конспект правил GDScript в AGENTS.md
- Прочитан `docs/gdscript_guidelines.md`, ключевые пункты сведены в краткий список и добавлены в секцию `## GDScript guidelines` файла `AGENTS.md`.
- Одновременно привёл секцию `Using MCP / References` к финальной английской формулировке (context7 для GDScript, другие языки — по необходимости).

### 2023-12-16 — Секция про версию Godot
- В `AGENTS.md` заполнен блок `## Godot Enguine Version`: указано, что проект ведётся на Godot 4.5 (stable), и добавлена ссылка на строку `config/features` в `project.godot`.
- Пользователю можно ссылаться на `project.godot:15`, где хранится текущий набор feature-флагов, чтобы увидеть версию, с которой был сохранён проект.

### 2023-12-16 — Коммиты: AGENTS и экспорт
- Нужно сделать два отдельных коммита: первый — для правок `AGENTS.md` и связанных документов, второй — для изменений в настройках экспорта (`export_presets.cfg`).
- Следует аккуратно проиндексировать только соответствующие файлы, чтобы пользовательские изменения вне задачи не попали в коммиты.

### 2023-12-16 — Коммиты выполнены
- Создан коммит `docs: update AGENTS guidelines` (вошли `AGENTS.md`, `docs/gdscript_guidelines.md`, `docs/notes/task_analysis.md`).
- Создан коммит `chore: update export presets`, содержащий изменения только в `export_presets.cfg`.

### 2023-12-16 — Просьба: сквош последних двух коммитов
- Нужно объединить коммиты `docs: update AGENTS guidelines` и `chore: update export presets` в единый коммит.

### 2023-12-16 — Сквош выполнен
- Через `git reset --soft HEAD~2` + `git commit` создан единый коммит `chore: unify AGENTS updates and export presets`.
- При этом убедился, что сторонние изменения (например, `docs/project.md`) остались вне stage.

### 2023-12-16 — Вопрос по headless-билдам
- Нужно ответить, как собирать Godot-проекты (несколько конфигураций) без открытия UI, через CLI.

### 2023-12-16 — Проблема: бинарь Godot отсутствует в PATH
- Пользователь уточнил, что имеющийся бинарь `/Applications/Godot.app/.../Godot` не попадает в `$PATH`, а команда `godot4` недоступна.
- Решение (добавить путь в `~/.zshrc` или alias) отработало.

### 2023-12-16 — Настройка headless-билда для Web (itch), Web (local), macOS
- Нужно описать конкретные команды `Godot --headless --export...` для трёх пресетов: `"Web (itch.io)"`, `"Web (local)"`, `"macOS"`.
- Пользователь уточнил: использовать имя бинарника `godot4`; Web (itch.io) собирать релизом, а `Web (local)` и `macOS` — в debug-варианте.

### 2023-12-16 — Конфигурация для `just`
- Требуется добавить в репозиторий `justfile`, который автоматизирует сборку всех трёх пресетов.
- В рецептах нужно использовать ранее обсуждённые команды `godot4 --headless --export-*`.

### 2023-12-16 — `justfile` готов
- Добавлен `justfile` в корне проекта.
- Задачи `web-itch`, `web-local`, `mac-debug` создают выходные каталоги и вызывают `godot4 --headless` с нужными пресетами/флагами; `build-all` зависит от всех трёх.

### 2023-12-16 — Архивация Web (itch.io)
- Нужно дополнить задачу `web-itch` в `justfile`: после экспорта собирать файлы в zip-архив и удалять исходный каталог.

### 2023-12-16 — Архивация добавлена
- `web-itch` теперь архивирует сборку (`zip -r ../web_itch.zip .`) и удаляет временную папку.

### 2023-12-16 — Требование: save-and-clear
- Нужно завести папки `builds/current` и `builds/archive`.
- При каждой сборке заново наполняем `current` (старая сборка затирается).
- Команда `save-and-clear` должна сохранять `current` в zip архив внутри `archive` с постфиксом `_YYMMDD_hhmmss`, затем очищать `current`.

### 2023-12-16 — Реализация save-and-clear
- Цели `web-itch`, `web-local`, `mac-debug` теперь собирают в `builds/current/...` (предварительно очищая прежние артефакты).
- Добавлена цель `save-and-clear`, архивирующая `builds/current` в `builds/archive/build_YYMMDD_hhmmss.zip` и удаляющая содержимое `current`.

### 2023-12-16 — Проблема: `godot4` недоступен для just
- Alias `godot4` не доступен внутри рецептов `just`, поэтому команды падают с `command not found`.
- Нужно указать явный путь к бинарю или сделать переменную `GODOT_BIN` с дефолтным значением.
