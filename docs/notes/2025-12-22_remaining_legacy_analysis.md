# Анализ: оставшиеся legacy-участки (после удаления Node-взаимодействий)

## Контекст
Legacy Node-взаимодействия удалены. Требуется новый анализ на предмет оставшихся legacy-участков в кодовой базе.

## Поиск и результаты
- Каталог `scripts/sim/**` отсутствует (legacy core не обнаружен).
- Поиск `legacy|TODO|migration|migrate` в `scripts/` — совпадений не найдено.
- В `scripts/app` и `scripts/domain` нет `extends Node`, что соответствует требованиям чистого core.
- Ссылок на удалённые `interaction_engine_legacy` / `interaction_target` в `scripts/` и `scenes/` нет.

## Предварительный вывод
Явных legacy-участков в коде не обнаружено. Возможные зоны риска — адаптеры UI/wardrobe, если они всё ещё содержат правила вместо отправки команд в core, но это требует уточнения критериев “legacy” для текущего этапа.

## Архитектурные наблюдения
- Текущая структура соответствует слоям: `domain` (RefCounted state), `app` (use cases), `ui/wardrobe` (adapters).
- Без явных TODO/legacy‑маркеров сложно отличить “нормальный адаптер” от “legacy‑логики”.

## Варианты дальнейшего анализа
1) **Ограниченный (по структуре):**
	- Считать legacy только те участки, которые нарушают правила слоя (Node‑зависимости в core, UI‑логика с правилами).
2) **Поведенческий (по сценариям):**
	- Проверить конкретные сцены/сценарии геймплея и найти места, где правила живут в UI.
3) **Архитектурный аудит:**
	- Пройти по всем `scripts/ui` и `scripts/wardrobe` и выделить потенциальные rule‑ветки для миграции в `app/domain`.

## Модули/классы для фокуса (если нужен более глубокий аудит)
- `scripts/ui/wardrobe_scene.gd`
- `scripts/ui/wardrobe_interaction_events.gd`
- `scripts/wardrobe/interaction_event_adapter.gd`

## Тесты
- Базовый unit‑набор существует: `./addons/gdUnit4/runtest.sh -a ./tests/unit`.
- Если будут выявлены legacy‑участки в UI‑логике, нужно будет решить: добавлять ли интеграционные тесты сцен (или unit‑тесты на app/domain вместо UI‑поведения).

## Открытые вопросы
- Что считать legacy в этом раунде: только Node‑взаимодействия, или любое правило в UI/wardrobe?
- Какие игровые сцены/функции считаются “заявленной функциональностью”, которые нельзя ломать?
- Нужен ли глубокий аудит `scripts/ui`/`scripts/wardrobe`, или достаточно проверки слоёв?
